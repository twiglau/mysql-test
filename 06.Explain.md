# Explain 性能分析

## 是什么（执行计划）

使用 EXPLAIN 关键字可以模拟优化器执行 SQL 查询语句，从而知道 MySL 是如何处理你的 SQL 语句的。
分析你的查询语句或是表结构的性能瓶颈

## 能干什么

1. 表的读取顺序
2. 数据读取操作的操作类型
3. 哪些索引可以使用
4. 哪些索引被实际使用
5. 表之间的引用
6. 每张表有多少行被优化器查询

## 怎么玩

- Explain + SQL 语句
- 执行计划包含的信息
  id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra

## 各字段解释

1. id - select 查询的序列号，包含一组数字，表示查询中执行 select 子句或操作表的顺序

- id 相同：执行顺序由上至下
- id 不同：如果是子查询，id 的序号会递增，id 值越大，优先级越高，越先被执行。
- id 相同和不同，同时存在：id 如果相同，可以认为是一组，从上往下顺序执行；在所有组中，id 值越大，优先级越高，越先执行；

2. select_type

- 有哪些
  SIMPLE, PRIMARY, SUBQUERY, DERIVED, UNION, UNION RESULT

- 查询的类型，主要是用于去呗： 普通查询，联合查询，子查询等的复杂查询。

  1. SIMPLE - 简单的 select 查询，查询中不包含子查询或者 UNION
  2. PRIMARY - 查询中若包含任何复杂的子部分，最外层查询被标记。
  3. SUBQUERY - 在 select 或 where 雷彪中包含子查询
  4. DERIVED - 在 FROM 列表中包含的子查询被标记为 DERIVED(衍生)，MySQL 会递归执行这些子查询，把结果放在临时表里。
  5. UNION - 若第二个 SELECT 出现在 UNION 之后，则被标记为 UNION;若 UNION 包含在 FROM 子句的子查询中，外层 SELECT 将被标记为：DERIVED.
  6. UNION RESULT - 从 UNION 表获取结果的 SELECT

3. table - 显示这一行的数据是关于哪张表的；

4. type 类型：System | const | eq_ref | ref | range | index | all

- 访问类型排列，显示查询使用了何种类型；
- 从最好到最差依次是：
  system > const > eq_ref > ref > range > index > ALL(是全表扫描)
- 一般来说，得保证查询至少达到 range 级别，最好能达到 ref.
  1. system: 表只有一行记录（等于系统表），这是 const 类型的特例，平时不会出现，可以忽略不计
  2. const: 表示通过索引一次就找到了。const 用于比较 primary key 或者 unique 索引。因为只匹配
     一行数据，所以很快。如将主键置于 where 列表中，MySQL 就能将该查询转换为一个常量。

5. possible_keys
6. key
7. key_len
8. ref
9. rows
10. Extra

## 热身 Case
